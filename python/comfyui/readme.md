# ğŸ–¼ï¸ ComfyUI PNG Image Text Extractor

Extract embedded prompt text from ComfyUI-generated PNG images with drag-and-drop support and robust parsing.

## âœ¨ Features

- ğŸ“‚ **File Selection** - Browse for ComfyUI PNG files
- ğŸ–±ï¸ **Drag & Drop** - Drop images directly into the application
- ğŸ‘ï¸ **Image Preview** - Thumbnail display of loaded images  
- ğŸ“‹ **Copy to Clipboard** - One-click copy of extracted text
- ğŸ¨ **Dark Theme** - Easy on the eyes interface
- ğŸ”„ **Multiple Extraction Methods** - Robust parsing with fallback options
- âœ… **File Validation** - Ensures only PNG files are processed
- ğŸ“Š **Status Bar** - Real-time feedback on operations
- ğŸ—‘ï¸ **Clear Function** - Reset view with one click

## ğŸ“¦ Installation

```bash
pip install -r requirements.txt
```

### Requirements
- Python 3.7+
- tkinterdnd2
- Pillow  
- pyperclip

## ğŸš€ Usage

```bash
python image_prompt_text_dragndrop.py
```

### Using the Application

1. **Load Image**:
   - Click **"ğŸ“‚ Select PNG File"** to browse for a file
   - **OR** drag and drop a PNG image onto the drop zone

2. **View Results**:
   - Image thumbnail displays automatically
   - Extracted prompt text appears in the text area
   - Status bar shows operation results

3. **Copy Text**:
   - Click **"ğŸ“‹ Copy Text to Clipboard"**
   - Text is automatically cleaned (whitespace normalized)

4. **Clear**:
   - Click **"ğŸ—‘ï¸ Clear"** to reset the view

## âš™ï¸ How It Works

The script uses multiple extraction methods for robust text retrieval:

### Method 1: JSON Structure Parsing
Searches for complete JSON blocks with patterns like:
- `"prompt": {...}`
- `"text": "..."`
- `{"text": "..."}`

### Method 2: Binary Pattern Matching
Fallback method that searches for `"text": "` patterns in the binary data with proper escape handling.

### Method 3: PNG tEXt Chunks
Reads standard PNG metadata chunks for text information.

## ğŸ”§ Features Explained

### Robust Text Extraction
- Multiple parsing strategies ensure maximum compatibility
- Handles various ComfyUI export formats
- Proper Unicode handling with error recovery

### UI Improvements
- Clean, modern dark theme
- Emoji icons for better visual navigation
- Status bar for real-time feedback
- Scrollable text area for long prompts

### Error Handling
- File type validation
- Graceful error messages
- Detailed status updates

## âš ï¸ Notes

- Only works with PNG images generated by ComfyUI
- Supports multiple ComfyUI metadata formats
- Extracted text is normalized for clipboard copying (whitespace cleaned)
- Status bar provides real-time operation feedback

## ğŸ› Troubleshooting

**"Text not found in image metadata"**
- Ensure the image was generated by ComfyUI
- Some older ComfyUI versions may use different metadata formats

**Image won't load**
- Verify the file is a valid PNG
- Check file permissions

## ğŸ“ Changelog

### Version 2.0 (Current)
- âœ… Added multiple text extraction methods
- âœ… Improved JSON parsing with proper structure detection
- âœ… Added PNG tEXt chunk support
- âœ… Enhanced UI with status bar and clear button
- âœ… Better error handling and user feedback
- âœ… File validation before processing
- âœ… Emoji icons for better UX
- âœ… Fixed requirements.txt (removed built-in modules)

### Version 1.0
- Initial release
- Basic drag and drop functionality
- Simple text extraction

## ğŸ“„ License

MIT License - See LICENSE file for details

## ğŸ¤ Contributing

Contributions welcome! Areas for improvement:
- Additional metadata format support
- Batch processing capabilities  
- Export options (JSON, TXT)
- Image comparison tools

## ğŸ’¡ Tips

- Use the drag-and-drop for fastest workflow
- Extracted text maintains original formatting
- Status bar color indicates operation success/failure
- Clear button resets everything for next image